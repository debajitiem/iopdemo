/*
 * Command line: gradle -Piib_env=QA|PROD|DEV Ant Target (e.g. deploy, compile, * test)
 * or place in gradle.properties file.
 * The deployOnly property can be set to 'true' if an existing BAR file
 * has to be deployed only; not first compiled.
 */

/* First set the mqsi environment so that the Ant build file can find
 * mqsi commands
 */

ext.mqsiprofileDir = ext.mqsiprofilePathWin
ext.mqsiCmdLine = 'cmd /c'

if (org.gradle.internal.os.OperatingSystem.current().windows) {

        ant.properties['iib.os.win'] = true

} else {

        ext.mqsiprofileDir = ext.mqsiprofilePathUnix
        ext.mqsiCmdLine = 'source'

        ant.properties['iib.os.win'] = false
}

println ext.mqsiprofileDir
println ext.mqsiCmdLine

/*
task setMqsiprofile(type:Exec) {

  workingDir ext.mqsiprofileDir
  commandLine ext.mqsiCmdLine, 'mqsiprofile'
}
*/

switch (iib_env) {

         case "PROD":
          ant.properties['iib.node.specfile'] = 'iib-node-prod.xml'
          ant.properties['iib.override.file'] = 'override-prod.properties'
          break;
         case "QA":
          ant.properties['iib.node.specfile'] = 'iib-node-qa.xml'
          ant.properties['iib.override.file'] = 'override-qa.properties'
          break;
         default:
         ant.properties['iib.node.specfile'] = 'iib-node.xml'
         ant.properties['iib.override.file'] = 'override.properties'

}

ant.properties['deploy.only'] = ext.deployOnly

ant.importBuild 'build.xml'
